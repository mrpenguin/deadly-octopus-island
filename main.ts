namespace myTiles {
    //% blockIdentity=images._tile
    export const tile0 = img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `
    //% blockIdentity=images._tile
    export const tile2 = img`
        b b b b b b b b
        e e e b b b b b
        b b b b b b b b
        b b b b b e e e
        b b b b b b b b
        b b e e e e e b
        b b b b b b b b
        b e e b b b e b
    `
    //% blockIdentity=images._tile
    export const tile3 = img`
        b b b b b b e d
        b b b e e b e d
        b b b b b b e d
        e e b b b b e d
        b b b b b b e d
        b b b b b b e d
        b b e e b b e d
        b b b b b b e d
    `
    //% blockIdentity=images._tile
    export const tile4 = img`
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
    `
    //% blockIdentity=images._tile
    export const tile5 = img`
        d e b b b b b b
        d e b b b e e b
        d e b b b b b b
        d e b e e b b b
        d e b b b b b e
        d e b b b b b b
        d e b b b e e b
        d e b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile6 = img`
        7 5 5 5 5 5 5 7
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        7 5 5 5 5 5 5 7
    `
    //% blockIdentity=images._tile
    export const tile7 = img`
        e b b b b b b e
        b b b b b b b b
        b e e b b b b b
        b b b b b b e e
        b b b b b b b b
        b b b b b b b b
        e e e e e e e e
        d d d d d d d d
    `
    //% blockIdentity=images._tile
    export const tile8 = img`
        d d d d d d d d
        e e e e e e e e
        b b b b b b b b
        e b b b b b b e
        b b b b b b b b
        b b b b e e b b
        b b b b b b b b
        b e e b b b e b
    `
    //% blockIdentity=images._tile
    export const tile9 = img`
        b b b b b b e d
        b e e b b b e e
        b b b b b b b b
        b b b e b b e e
        b b b b b b b b
        b b e e b b b b
        b b b b b b b b
        b e b b b e e b
    `
    //% blockIdentity=images._tile
    export const tile10 = img`
        b b b b b b b b
        b e e b b b b b
        b b b b b e e b
        b b b b b b b b
        b b e e b b b b
        b b b b b b b b
        e e b b e b b e
        d e b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile11 = img`
        d e b b b b b b
        e e b e e b b e
        b b b b b b b b
        b b e b b e e b
        b b b b b b b b
        b e e b b b b b
        b b b b e e b b
        b e b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile12 = img`
        e b b b b b b b
        b b b b b e e b
        b e e b b b b b
        b b b b b b b b
        e b b b e e b b
        b b b b b b b b
        b e b e b b e e
        b b b b b b e d
    `
    //% blockIdentity=images._tile
    export const tile13 = img`
        d e b b b b b b
        d e b b e e b b
        d e b b b b b b
        d e b e b b b b
        d e b b b e e b
        d e b b b b b b
        d e e e e e e e
        d d d d d d d d
    `
    //% blockIdentity=images._tile
    export const tile14 = img`
        b b b b b b e d
        b b e e b b e d
        b b b b b b e d
        e b b b b b e d
        b b b e e b e d
        b b b b b b e d
        e e e e e e e d
        d d d d d d d d
    `
    //% blockIdentity=images._tile
    export const tile15 = img`
        d d d d d d d d
        e e e e e e e d
        b b b b b b e d
        b b e e b b e d
        b b b b b b e d
        e b b b b b e d
        b b b e e b e d
        b b b b b b e d
    `
    //% blockIdentity=images._tile
    export const tile16 = img`
        d d d d d d d d
        d e e e e e e e
        d e b b b b b b
        d e b b b e e b
        d e b b b b b b
        d e b e e b b b
        d e b b b b b e
        d e b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile17 = img`
        b b b b b b b b
        b b 3 3 3 b b b
        b b 3 b b 3 b b
        b b 3 b b 3 b b
        b b 3 3 3 b b b
        b b 3 b b b b b
        b b 3 b b b b b
        b b b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile18 = img`
        d b b b b b b d
        b d b b b b d b
        b b d b b d b b
        b b b d d b b b
        b b b d d b b b
        b b d b b d b b
        b d b b b b d b
        d b b b b b b d
    `
    //% blockIdentity=images._tile
    export const tile19 = img`
        b b b b b b b b
        b b 2 2 2 b b b
        b 2 b b b 2 b b
        b 2 b b b b b b
        b b 2 2 2 b b b
        b b b b b 2 b b
        b 2 b b b 2 b b
        b b 2 2 2 b b b
    `
    //% blockIdentity=images._tile
    export const tile20 = img`
        4 4 4 4 4 4 4 4
        4 4 4 4 4 4 4 4
        5 5 5 5 5 5 5 5
        4 4 4 4 4 4 4 4
        4 4 4 4 4 4 4 4
        5 5 5 5 5 5 5 5
        4 4 4 4 4 4 4 4
        4 4 4 4 4 4 4 4
    `
    //% blockIdentity=images._tile
    export const tile21 = img`
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
    `
    //% blockIdentity=images._tile
    export const tile22 = img`
        b b b 5 5 b b b
        b 5 b 5 5 b 5 b
        b b b 5 b b b b
        5 5 b b b 5 5 5
        5 5 5 b b b 5 5
        b b b b 5 b b b
        b 5 b 5 5 b 5 b
        b b b 5 5 b b b
    `
    //% blockIdentity=images._tile
    export const tile23 = img`
        d d d d d d d d
        d 4 5 4 4 5 4 d
        d 4 5 4 4 5 4 d
        d d d d d d d d
        d 4 5 d d 5 4 d
        d 4 5 4 4 5 4 d
        d 4 5 4 4 5 4 d
        d d d d d d d d
    `
    //% blockIdentity=images._tile
    export const tile24 = img`
        d d d d d d d d
        d d d d d d d d
        d d d d d d d d
        d d d d d d d d
        d 4 5 d d 5 4 d
        d 4 5 4 4 5 4 d
        d 4 5 4 4 5 4 d
        d d d d d d d d
    `
    //% blockIdentity=images._tile
    export const tile25 = img`
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
    `
}

let titleScreen = img`
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111c1111111111111111111111111111111111111111111
    111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111cc1111111111111111111ccccc11111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111cccc11111111111111111cccc33111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111cc3311111111111111111ccc311111111111111111111111111111111111111111111
    111111111111111111ff1111111111111111111111111111fffff111111ff111111111111111ff1111111111111c33111111111111111111cc3111111111111111111111111111111111111111111111
    1111111111111111ffffff111111111ff11111f11111111fffffff11111fff11111ff111111fff1111111111111c3331111111111111111cc311111111111111111111111111111111cccc1111111111
    111111111111111ffffffff111111ffffff11fff1111111fff11fff1111fff11111ff111111fff1111111111111cc333111111111111111c3311111111111111111111111111111ccccccccc11111111
    111111111111111ffff1ffff11111ffffff11ffff111111fff111fff111fff11111fff1111ffff11111111111111cc33331111111111111c331111111111111111111111111111cccccc333111111111
    111111111111111ffff11ffff111ffffff111fffff11111fff111fff111fff11111ffff111fff1111111111111111cc3333111111111111c331111111111111111111111111111ccc333311111111111
    111111111111111ffff111fff111fff111111fffff11111fff1111ff111fff111111fff11ffff11111111111111111ccc33311111111111c333111111111111111111111111111cc3331111111111111
    111111111111111ffff1111ff111fff111111ff11ff1111fff11111ff11fff1111111fffffff1111111111111111111ccc3331111111111c33311111111111111111111111111ccc3311111111111111
    1111111111111111fff1111ff111ffffff111ff11ff1111fff11111ff11fff11111111ffffff1111111111111111111cccc331111111111cc3331111111111111111111111111cc33111111111111111
    1111111111111111fff11111ff111ffffff11ff111ff111fff11111ff11fff111111111ffff111111111111111111111ccc331111111111cc3331111111111111111111111111cc33111111111111111
    1111111111111111fff11111ff111fffff111ff111ff111fff11111ff11fff111111111ffff111111111111111111111ccc333111111111ccc331111111111111111111111111cc33111111111111111
    1111111111111111fff11111ff111ff111111fffffff111fff11111ff11fff1111111111fff1111111111111111111111ccc331111111111cc33111111111111111111111111ccc33111111111111111
    1111111111111111fff11111ff111fff11111ffffffff11fff11111ff11fff1111111111fff1111111111111111111111ccc331111111111cc33311111111111111111111111cc333111111111111111
    1111111111111111fff1111fff111fff11ff1ff1111ff11ffff1111ff11fff1111111111fff1111111111111111111111ccc331111111111cc3331111111111111111111111ccc331111111111111111
    1111111111111111ffffffffff111ffffffffff1111fff1ffff111fff11fff111fff1111fff111111111111111111111cccc33111111111cccc331111111111ccccc111111ccc3331111111111111111
    11111111111111111fffffffff111fffffff1ff1111fff1fffffffff111ffffffffff111fff11111111111111111111cccc33311111111ccccc33111111111ccccccccccccccc3311111111111111111
    111111111111111111fffffff11111ffff111fff111fffffffffffff111fffffffff1111fff1111111111111111111cccc33331111111ccccc33311111111cccccccccccccc333111111111111111111
    111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ccccc3333111111cccccc33311111111cccccccccccc33331111111111111111111
    111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111cccc33333111111ccccc333111111111cccccc33333333311111111111111111111
    111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111cccc33331111111cccc3333111111111ccccc333333331111111111111111111111
    1111111ccc111111111111111111111111111111111111111111111111111111111111111111111111111111111111ccc333311111111ccc3331111111111cccc3333111111111111111111111111111
    111111133c1111111111111111111111111111111111111111111111111111111111111111111111111111111111111ccc331111111111cccc111111111111ccc3331111111111111111111111111111
    111111113cc111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111c3311111111111111111111111111111
    111111113cc11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111133cc111111111111111111111ccccc1111111111111111111111cccccccccccc11111111111111111cccccccc111111111111111111111111111111111111111111111111111111111111111
    11111111333ccccc1111111111111111ccccccccc11111111111cccc111cccccccccccccc11111ccccc11111cccccccccc111ccc111111cccc111111cccccc1111111111111111111111111111111111
    11111111333ccccccc1111111111111ccccccccccc111111111cccccc11cccccccccccccc111cccccccc1111cccc11cccc111ccc111111cccc11111cccccccc111111111111111111111111111111111
    111111111333ccccccc111111111111ccccccccccc11111111ccccccc111cccccccccccc1111ccccccccc111ccc11111ccc11ccc111111cccc1111cccccccc1111111111111111111111111111111111
    1111111113333333cccc11111111111ccccc111ccc1111111cccccc11111111ccccc1111111cccccccccc111ccc11111ccc11ccc111111cccc111ccccc1111111111111ccc1111111111111111111111
    111111111113333333ccc11cc11111ccccc11111ccc11111ccccc11111111111cccc111111cccc1111cccc11ccc11111ccc11ccc111111cccc111ccc11111111111111cccccc11111111111111111111
    1111111111111133333ccccccc1111ccc1111111ccc11111cccc111111111111cccc111111ccc111111ccc11ccc11111ccc11ccc111111cccc111ccc1111111111111cccccccc1111111111111111111
    1111111111111111333cccccccc111ccc11111111ccc111cccc1111111111111cccc111111ccc111111ccc11ccc1111ccc111ccc111111cccc111cccccccc111111133ccccccc1111111111111111111
    11111111111111111333ccccccc111ccc11111111ccc111cccc1111111111111cccc11111cccc1111111cc11cccccccccc111ccc111111cccc111cccccccccc111113333cccccc111111111111111111
    111111111111111113333cccccc111ccc11111111ccc111ccc11111111111111cccc11111ccc11111111cc11ccccccccc1111ccc111111cccc111cccccccccc1111113333cccccc11111111111111111
    111111111111111111333333331111ccc11111111ccc111ccc11111111111111cccc11111ccc11111111cc11cccccccc11111ccc111111cccc111111ccccccc11111133333ccccc11111111111111111
    111111111111111111133333331111ccc11111111ccc111ccc11111111111111cccc11111ccc11111111cc11cccc111111111ccc111111cccc111111111ccccc11111133333ccccc1111111111111111
    111111111111111111111333111111ccc1111111cccc111ccc11111111111111cccc11111ccc11111111cc11cccc1111111111ccc11111cccc1111111111cccc111111133333ccccc111111111111111
    111111111111111111111111111111ccc1111111cccc111ccc11111111111111cccc11111ccc1111111ccc11cccc1111111111ccc11111cccc1111111111cccc1111111133333cccccc1111111111111
    111111111111111111111111111111ccc1111111cccc111ccc11111111111111cccc11111ccc1111111ccc11cccc1111111111ccc11111cccc1111111111cccc11111111113333333ccccccc11111111
    111111111111111111111111111111ccc111111cccc1111ccc11111111111111cccc11111cccc111111ccc11cccc1111111111ccc11111cccc1111111111cccc1111111111113333333cccccc1111111
    111111111111111111111111111111ccccc111ccccc11111ccc111111cc11111cccc11111cccccc111cccc11cccc11111111111cccc111cccc111111111ccccc11111111111111133333333ccc111111
    1111111111111111111111111111111ccccccccccc111111cccc111ccccc1111cccc111111cccccccccccc11cccc11111111111cccc11cccc11111ccccccccc1111111111111111111111333cc111111
    111111111111111111111cccc111111cccccccccc1111111cccccccccccc11111ccc111111ccccccccccc111cccc11111111111cccccccccc1111cccccccccc11111111111111111111111333c111111
    11111111111111111111cccc31111111cccccccc111111111cccccccccc111111cc111111111cccccccc11111ccc111111111111ccccccccc1111cccccccc1111111111111111111111111133cc11111
    1111111111111111111cccc3331111111ccccc1111111111111ccccc111111111111111111111cccccc1111111cc111111111111cccccccc111111ccccc1111111111111111111111111111133c11111
    1111111111111111111cccc3331111111111111111111111111111111111111111111111111111111111111111111111111111111ccccc11111111111111111111111111111111111111111133c11111
    1111111111111111111cccc33311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113c11111
    111111111111111111ccccc3331111111ccccc1111111111111111111ccc1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113cc1111
    1111111111111ccc11cccc3333111111cccccccc1111111111111111ccccc1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111133c1111
    11111111111ccccccccccc3331111111ccccc333111111111111111ccc3333111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111c1111
    1111111111cccccccccc333331111111cccc333311111111111111cccc333311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    111111111ccc3333ccc3333311111111cccc333331111111111111cccc3333311111111111111ffffffffffff11111111111111111111111111111111111111111111111111111111111111111111111
    11111111ccc3333333333111111111111ccc333331111111111111cccc3333311111111111111fffffffffffff11111fffff11fff1111111111ff1111111ff1111111ff111ffff111111111111111111
    1111111ccc33311333331111111111111cccc333311111111111111cccc3333111111111111111ffffffffffff1111ffffff11fff111111111ffff111111fff11111fff1ffffffff1111111111111111
    1111111ccc331111111111111111111111cccc333111111111111111ccc33331111111111111111111fff11111111fffff1111fff111111111ffff11111fffff1111fff1fff111fff111111111111111
    1111111cc33111111111111111111111111ccc3331111111111111111cc33331111111111111111111fff11111111fff111111fff111111111ffff11111fffff1111fff1fff1111fff11111111111111
    1111111cc311111111111111111111111111cc3331111111111111111cc33311111111111111111111fff1111111fff1111111fff11111111ff11ff1111ffffff111fff1fff11111ff11111111111111
    111111ccc311111111111111111111111111cc3331111111111111111c333311111111111111111111fff1111111fff1111111fff11111111ff11fff111ffffff111fff1fff11111fff1111111111111
    111111cc331111111111111111111111111ccc333111111111111111cc333111111111111111111111ffff111111fff111111ffff1111111fff11fff111fffffff11fff1fff11111fff1111111111111
    111111cc311111111111111111111111111cc333311111111111111cc3331111111111111111111111ffff111111fffffff11fff11111111ffffffff111fff1fff11fff1fff11111fff1111111111111
    1111111c11111111111111111111111111ccc33311111111111111cc33331111111111111111111111ffff1111111fffffff1fff11111111ffffffff111fff1ffff1fff1fff11111fff1111111111111
    1111111111111111111111111111111111ccc3311111111111111cc3333111111111111111111111111fff111111111fffff1fff11111111fffffffff11fff11fff1fff1fff11111fff1111111111111
    111111111111111111111111111111111ccc3331111111111111cc33331111111111111111111111111fff11111111111fff1fff1111111ffff11ffff11fff11fffffff1fff11111fff1111111111111
    11111111111111111111111111111111cccc331111111111111cc333311111111111111111111111111fff11111111111fff1fff1111111ffff111fff11fff111ffffff1fff11111fff1111111111111
    1111111111111111111111111111111cccc333111111111111cc3333111111111111111111111111111ffff1111111111fff1fff111ff11ffff111fff11fff1111fffff1ffff1111fff1111111111111
    111111111111111111111111111111cccc3331111111111111cc333111111111111111111111111ffffffffffff11fffffff1fffffffff1fff1111ffff1fff11111ffff1ffff111fff11111111111111
    11111111111111111111111111111ccc333311111111111111cc331111111111111111111111111ffffffffffff11ffffff11ffffffff11fff11111fff1fff11111ffff1ffffffffff11111111111111
    1111111111111111111111111111ccc3331111111111111111cc3311111111111111111111111111ffffffffff111fffff111fffffff111fff11111fff1fff111111fff1fffffffff111111111111111
    111111111111111111111111111cc333311111111111111111cc331111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    11111111111111111111111111cc3311111111111111111111cc331111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    11111111111111111111111111cc3111111111111111111111cc333111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111cc331111111111111111111111cc33311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111cc331111111111111111111111ccc3311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111cc3111111111111111111111111ccc311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111cc31111111111111111111111111cc331111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111ccc11111111111111111111111111cc31111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    111111111111111111111111111c11111111111111111111111111cc33111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111cc3111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111cc3111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    111111111111111111111111111111111111111111111111111111cc31111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    111111111111111111111111111111111111111111111111111111cc31111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    11111111111111111111111111111111111111111111111111111cc311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    11111111111111111111111111111111111111111111111111111cc111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111133331111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111ffff11111111111111111111111111111113333333311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111f111f11111111111111111111111111111333333333311111111111111111111111111111111111f111111111111111f111111111111111111111111111111111111
    1111111111111111111111111111f111f111111111111111111111111111133333ff3333311111111111f1111111111111111111111f111111111111111f111111111111111111111111111111111111
    1111111111111111111111111111f111f11111111111111111111111111113333f33f333311111111111f11111111111111111111fffff11111111111fffff1111111111111111111111111111111111
    1111111111111111111111111111ffff111111111111111111111111111133333f33f3333311111111fffff11111111111111111111f111111111111111f111111111111111111111111111111111111
    1111111111111111111111111111f11111ff1111111111111111111111113333f3333f33331111111111f1111111111111111111111f111111111111111f111111111111111111111111111111111111
    1111111111111111111111111111f1111f11f1ff11fff1fff111111111113333f3333f33331111111111f111fff1111111111fff111f11111f111f1f111f111111111111111111111111111111111111
    1111111111111111111111111111f1111f111f11f1f111f11111111111113333ffffff33331111111111f11f111f111111111f11111f11ffff111ff1f11f111111111111111111111111111111111111
    1111111111111111111111111111f1111f111ffff11f111f1111111111113333f3333f33331111111111f11f111f1111111111f1111f11f11f111f11111f111111111111111111111111111111111111
    1111111111111111111111111111f1111f111f111111f111f111111111111333f3333f33311111111111f11f111f11111111111f111f11f11f111f11111f111111111111111111111111111111111111
    1111111111111111111111111111f1111f1111fff1fff1fff111111111111333f3333f33311111111111f111fff1111111111fff111f11fffff11f11111f111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111133333333331111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111113333333311111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111133331111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    `

let blankBackground = img`
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
`

let waypointHolding:HelperClasses.Waypoint = null
let sharkFollowsPlayer = false
let sharkTargetWaypoint: HelperClasses.Waypoint = null
let sharkPreviousWaypoint: HelperClasses.Waypoint = null
let playerInWater:boolean = false
let sharkSeekPath: Array<HelperClasses.PathPosition> = []
let waypoints: Array<HelperClasses.Waypoint> = []
let totalGuffins = 0
let currentLevel = 0
let playerLives = 3
let timer = 0
let finalTargetTiles: tiles.Location[] = []
const HIT_BUFFER:number = 4
const TILE_SIZE:number = 8
const PLAYER_MOVE_SPEED:number = 100
const SHARK_MOVE_SPEED:number = 2.1
const LEVEL_INTRO_DURATION:number = 5 * 30
let playerPosition: HelperClasses.Point = new HelperClasses.Point(0, 0)
let octopusPosition: HelperClasses.Point = new HelperClasses.Point(0, 0)
let sharkPosition: HelperClasses.Point = new HelperClasses.Point(0, 0)
let mySprite = sprites.create(img`
    . . . . . . . .
    . . . 1 1 . . .
    . . 1 1 1 1 . .
    3 4 1 1 1 1 4 3
    3 4 4 1 1 4 4 3
    . . 4 1 1 4 . .
    . . 1 1 1 1 . .
    . . . . . . . .
`, SpriteKind.Player)
let octopus = sprites.create(img`
    . a d d d . . . . . . . a d d d d d . . . . . . . . a a d d . .
    a d d . . . . . . . . a d d d d d d d d . . . . . a d d d d d .
    a d . . . . . . . . a d d 1 . . . . . d d . . . . a d . . . d d
    a d . . . . . . . . a d 1 . . . . . . . . . . . a d 1 . . . d d
    a d . . . . . . . . a d 1 . . . . . . . . . . a d d 1 . . . . d
    a d 1 . . . . . . . a d d d . . . . . . . . a d d d 1 . . . . .
    a d d 1 . . . . . . a d d a a a a a d d . . a d d d . . . . . .
    . a d d 1 . . . . . . a a d d d d d d d d d d d 1 . . . . . . .
    . . a d d d d d d . a d d d d d a d d d d d d d 1 . . . . . . .
    . . . a a d d d d a d d d a d d d d d d a d d d . . . . . . . .
    . . . . . a d d d a d d d d d d d d d d d d d d . . . . . a d .
    . . . . . . a a a d d d d d d d d a d d d d d d d . a a a d d d
    . . . . . . . . a d d a d d d d d d d d d d a d d a d d d d d d
    . . . . . . . . d d d d d d d d d d d d d d d d d d d 1 1 . d d
    . . . . . . . . d d d d d d d 1 1 1 d d d d d d d d d . . . d d
    . . . . . . . . d d d d d d 1 a a a 1 d d d d d d . . . . . . d
    . . . . . . . a d d d d d d 1 a d a 1 d d d d d 1 . . . . d d d
    . . . . . . a d d d d d d d 1 a d a 1 d d d d d 1 . . . . d d .
    . . . . a a d d d d d d d d 1 a a a 1 d d d d 1 d . . . . d . .
    . . a a d d d d d d d d d d d 1 1 1 d d d d d 1 d d 1 . . . . .
    . a d d d d d 1 1 1 d d d d d d d d d d d d d d d d 1 . . . . .
    a d d d d . . . . . a a d d d d d d d d 1 1 . d d d d 1 . . . .
    a d d d . . . . . a d d d d d d d 1 1 1 d 1 . . . d d d 1 . . .
    a d d . . . . . . a d d d d . . . d d d d 1 . . . a d d 1 . . .
    a d d . . . . . . a d d . . . . . . a d d 1 . . . . . d d 1 . .
    a d d . . . . . . a d d . . . . . . . a d d 1 . . . . d d 1 . .
    a d d . . . . . a d d . . . . . . . . . a d 1 . . . . a d d 1 .
    d d . . . . . . a d d . . . . . . . . . a d d . . . . . d d d .
    d d . . . . . . a d d . . . . . . . . . . d d d . . . . . d d d
    d d . . . . . . a d d . . . . . . . . d . . d d . . . . . . a d
    d d d . . . . . . a d . . . . . . . . d d d d d . . . . . . d d
    . d d . . . . . . . d d d . . . . . . . d d d . . . . . . d . .
`, SpriteKind.Enemy)
let shark = sprites.create(img`
    . . . . 8 d d .
    . . . 8 d d . .
    . . 8 d 1 . . .
    . 8 d d 1 . . .
    . 8 d d d 1 . .
    . d d d d d 1 .
    7 d d d d d d 7
    . 7 7 7 7 7 7 .
`, SpriteKind.Enemy)
let coin = sprites.create(img`
    . . 4 4 4 4 . .
    . 4 5 5 5 5 4 .
    4 5 5 4 5 5 5 4
    4 5 5 4 5 5 5 4
    4 5 5 4 5 5 5 4
    4 5 5 4 5 5 5 4
    . 4 5 5 5 5 4 .
    . . 4 4 4 4 . .
`, SpriteKind.Food)
coin.setPosition(-10, -10) //hide the initial coin where it can't be touched
let sharkTargetTile = new HelperClasses.Point()
const STATE_LEVEL_INIT: string = "state_level_init"
const STATE_LEVEL_RESTART: string = "state_level_restart"
const STATE_LEVEL_PLAY: string = "state_level_play"
const STATE_LEVEL_PLAYER_DEAD: string = "state_level_player_dead"
const STATE_LEVEL_END: string = "state_level_end"
const STATE_LEVEL_INTRO: string = "state_level_intro"
const STATE_GAME_OVER: string = "state_game_over"
const STATE_TITLE: string = "state_title";
let gameState:StateMachine.StateMachine = new StateMachine.StateMachine()

let level_32_32 = img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
`
let levelTiles = [myTiles.tile0, myTiles.tile2, myTiles.tile3, myTiles.tile4, myTiles.tile5, myTiles.tile6, myTiles.tile7, myTiles.tile8, myTiles.tile9, myTiles.tile10, myTiles.tile11, myTiles.tile12, myTiles.tile13, myTiles.tile14, myTiles.tile15, myTiles.tile16, myTiles.tile17, myTiles.tile18, myTiles.tile19, myTiles.tile20, myTiles.tile21, myTiles.tile22, myTiles.tile23, myTiles.tile24, myTiles.tile25]

let levels = [
    tiles.createTilemap(
        hex`200020000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010111010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010115010101011001010101150101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101011313130101010101010101010101010101010101010101010101010101010203030303030401010101010101010101010101010101010101010101010101020303050303040101010101010101010101010101010101010101010101010102030303030304010101010101010101010101010101010101010101010101010203030503030401010101010101010101010101010101010101010101010101020303030303040101010101010101010101010101010101010101010101010102030305030304010101010101010101010101010101010101010101010101010203030303030401010101010101010101010101010101010101010101010101020303050303040101010101010101010101010101010101010101010101010102030303030304010101010101010101010101010101010101010101010101010203030503030401010101010101010101010101010101010101010101010101020303030303040101010101010101010101010101010101010101010101010102030305030304010101010101010101010101010101010101010101010101010203030303030401010101010101010101010101010101010101010101010101020303050303040101010101010101010101010101010101010101010101010102030303030304010101010101010101010101010101010101010101010101010203031603030401010101010101010101010101010101010101010101010101020303030303040101010101010101010101010101010101010101010101010102030303030304010101010101010101010101010101010101010101010101010807070707070a010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101011501120101010101010115010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101`,
        level_32_32,
        levelTiles,
        TileScale.Eight
    ),
    tiles.createTilemap(
        hex`2000200001010101010101010101010101010101010101010101010101010101010101010101010101010101150b06060606060606060606060606011501010101010101010101010101010101020303030303030303030303030314010101011101010101010101011001010102030303160303050303050303031401010101010101010101010101010101010203030303030303030303030303140101010101010101010101010101010101080707070707070707070707070701010101010101010101011501010101011501010101010101150101010101010115010101011501010101010113131301010101010101010101010101010101010101131313010101010101020303030401010101010101010101010101010101010203030304010101010102030303040101010101010101010101010101010101020303030401010101010203050304010101010101010101010101010101010102030503040101010101020303030401010101010101010101010101010101010203030304010101010102030303040101010101010101010101010101010101020303030401010101010203050304010101010101010101010101010101010102030503040101010101020303030415010101010101011501010101010101150203030304010101010102030303040101010101010101010101010101010101020303030401010101010203050304010101010101010101010101010101010102030503040101010101020303030401010101010101010101010101010101010203030304010101010102030303040101010101010101010101010101010101020303030401010101010203050304010101010101010101010101010101010102030503040101010101020303030401010101010101010101010101010101010203030304010101010102030303040101010101010101010101010101010101020303030401010101010113131301010101010101010101010101010101010101131313010101010101010101010101010101010101010101010101010101010101010101010101011501010101011501010101010101150101010101010115010101011501010101010101010101010106060606060606060606060606010101010101010101010112010101010101140303030303030303030303030314010101010101010101010101010101010114030503030503030305030305031401010101010101010101010101010101011403030303030303030303030303140101010101010101010101010101010101010707070707070707070707070701010101010101010101010101010101011501010101010101010101010101010115010101010101010101010101010101010101010101010101010101010101010101010101010101`,
        level_32_32,
        levelTiles,
        TileScale.Eight
    ),
    tiles.createTilemap(
        hex`200020000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101011501011001011501010101010101010101010101010115010111010115010101010101010101010101010b06060606060606090101010101010101010101010101010101010101010101020303030303030304010101010101010101010101010101010101010101010102030503050305030401010101010101010101010101010b0606060901010101020303030303030304010101010b06060609010101010102030303040101010108070713131307070a0101010102030303040101010101020303031401010101010101010101010101010101011403030304010101010102030503140101010101010101010101010101010101140305030401010101010203030304010101010101010101010101010101010102030303040101010101020305030401010101010101010101010101010101010203050304010101010102030303041501010101010101150101010101010115020303030401010101010203030304010101010b0606060606060609010101010203030304010101010102030303040101010102030303030303030401010101020303030401010101010203030304010101010203030316030303040101010102030303040101010101020303030401010101020303030303030304010101010203030304010101010102030503040101010108070713131307070a010101010203030304010101010102030303040101010101010101010101010101010101020305030401010101011403050304150101010101010115010101010101011502030303040101010101140303030401010101010101010101010101010101010203050314010101010102030303040101010101010101010101010101010101020303031401010101010203030304010101010101010101010101010101010102030303040101010101080707070a0101010101010101010101010101010101080707070a010101011501010101011501010101010101150101010101010115010101010115010101010101010101010b0606060606060606060613130609010101010101010101010101010101010102030303030303030303030303030401010101010101010101120101010101010203030503050305030503050303040101010101010101010101010101010101020303030303030303030303030304010101010101010101010101010101010108071313070707070707070707070a010101010101010101011501010101011501010101010101010101010101010115010101010115010101010101010101010101010101010101010101010101010101010101010101`,
        level_32_32,
        levelTiles,
        TileScale.Eight
    )
    
]
function positionToTile(position: number, tileSize: number): number {
    return Math.floor(position / tileSize);
}
function isWaterTile(tileImage: Image): boolean {
    if (tileImage == myTiles.tile2 ||
        tileImage == myTiles.tile3 ||
        tileImage == myTiles.tile5 ||
        tileImage == myTiles.tile7 ||
        tileImage == myTiles.tile8 ||
        tileImage == myTiles.tile9 ||
        tileImage == myTiles.tile10 ||
        tileImage == myTiles.tile11 ||
        tileImage == myTiles.tile12 ||
        tileImage == myTiles.tile13 ||
        tileImage == myTiles.tile14 ||
        tileImage == myTiles.tile15 ||
        tileImage == myTiles.tile16) {
        return true
    }
    return false
}
function isLandTile(tileImage: Image): boolean {
    if (tileImage == myTiles.tile4) {
        return true
    }
    return false
}
function isWinningTile(tileImage: Image): boolean {
    if (tileImage == myTiles.tile24) {
        return true
    }
    return false
}
function isPlayerDead(player:Sprite, shark:Sprite, octopus:Sprite):boolean{
    if(spritesOverlappingWithBuffer(player, shark, 1)){
        return true
    }
    if(spritesOverlappingWithBuffer(player, octopus, 5)){
        return true
    }
    return false
}
function spritesOverlappingWithBuffer(baseSprite:Sprite, overlapSprite:Sprite, buffer:number):boolean {
    let left = baseSprite.x - baseSprite.width/2
    let right = baseSprite.x + baseSprite.width/2
    let overlapLeft = overlapSprite.x - overlapSprite.width/2 + buffer
    let overlapRight = overlapSprite.x + overlapSprite.width/2 - buffer
    if(left >= overlapLeft && left <= overlapRight || right <= overlapRight && right > overlapLeft ){
        let top = baseSprite.y - baseSprite.height/2
        let bottom = baseSprite.y + baseSprite.height/2
        let overlapTop = overlapSprite.y - overlapSprite.height/2 + buffer
        let overlapBottom = overlapSprite.y + overlapSprite.height/2 - buffer
        if(top >= overlapTop && top <= overlapBottom || bottom >= overlapTop && bottom <= overlapBottom){
            return true
        }
    }
    return false
}
function checkLandBoundsCollision(character: Sprite, lastPosition: HelperClasses.Point): HelperClasses.Point {
    let newTile: Image = tiles.getTileAt(positionToTile(character.x, TILE_SIZE), positionToTile(character.y, TILE_SIZE))
    if (lastPosition.tile == null) {
        lastPosition.tile = newTile
    }

    if (isLandTile(newTile) && isWaterTile(lastPosition.tile) ||
        isWaterTile(newTile) && isLandTile(lastPosition.tile)) {
        //todo: determine whether it's a horizontal or vertical collision and limit movement
        //also need to check whether the other position change results in a tile collision, like in a corner
        character.x = lastPosition.x
        character.y = lastPosition.y
        return lastPosition;
    }
    lastPosition.x = character.x
    lastPosition.y = character.y
    lastPosition.tile = newTile
    return lastPosition
}
function findOctopusMovePosition(octopusPosition: HelperClasses.Point, playerPosition: HelperClasses.Point, buffer: number): HelperClasses.Point {
    let moveLeft: boolean = playerPosition.x < octopusPosition.x - buffer
    let moveRight: boolean = playerPosition.x > octopusPosition.x + buffer
    let moveUp: boolean = playerPosition.y < octopusPosition.y - buffer
    let moveDown: boolean = playerPosition.y > octopusPosition.y + buffer
    let moveRate: number = .4

    if (moveLeft) {
        octopusPosition.x -= moveRate
    } else if (moveRight) {
        octopusPosition.x += moveRate
    }
    if (moveUp) {
        octopusPosition.y -= moveRate
    } else if (moveDown) {
        octopusPosition.y += moveRate
    }
    return octopusPosition
}
function findSharkMovePosition(sharkPosition: HelperClasses.Point, seekPath: Array<HelperClasses.PathPosition>): HelperClasses.Point {

    //need to keep track of tile position of player and only recalculate if the player has changed tiles

    return sharkPosition
}
function findSharkTargetTile(playerPosition: HelperClasses.Point): HelperClasses.Point {
    let resultGridSpot = new HelperClasses.Point()
    if (isWaterTile(playerPosition.tile)) {
        resultGridSpot.y = playerPosition.y
        resultGridSpot.x = playerPosition.x
        return resultGridSpot
    }
    return resultGridSpot
}
function moveGameSprite(position: HelperClasses.Point, sprite: Sprite): void {
    sprite.x = Math.floor(position.x)
    sprite.y = Math.floor(position.y)
}
function moveTowardPoint(position: HelperClasses.Point, point: HelperClasses.Point, moveRate:number):HelperClasses.Point{
    if(position.x < point.x){
        position.x += moveRate
        if(position.x > point.x){
            position.remainder = position.x - point.x
            position.x = point.x
        }
    }
    if(position.x > point.x){
        position.x -= moveRate
        if (position.x < point.x) {
            position.remainder = point.x - position.x
            position.x = point.x
        }
    }
    if(position.y < point.y){
        position.y += moveRate
        if (position.y > point.y) {
            position.remainder = position.y - point.y
            position.y = point.y
        }
    }
    if (position.y > point.y) {
        position.y -= moveRate
        if (position.y < point.y) {
            position.remainder = point.y - position.y
            position.y = point.y
        }
    }
    return position
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function (sprite, otherSprite) {
    info.setScore(info.score() + 1)
    otherSprite.destroy()
    if (info.score() == totalGuffins) {
        finalTargetTiles = tiles.getTilesByType(myTiles.tile23)
        finalTargetTiles.forEach(function (value: tiles.Location, index: number) {
            tiles.setTileAt(value, myTiles.tile24)
        })
    }
})
gameState.addBeforeStateChange(function (newState: string, oldState: string) {
    switch (oldState) {
        case STATE_TITLE:

        break;
        
        case STATE_LEVEL_INTRO:

            break;

        case STATE_LEVEL_INIT:

            break;

        case STATE_LEVEL_PLAY:
            controller.moveSprite(mySprite, 0, 0)
            break;

        case STATE_LEVEL_END:

            break;
    }
})
gameState.addStateChange(function (currentState: string) {
    switch (currentState) {
        case STATE_TITLE:
            octopus.setPosition(-100, -100)
            shark.setPosition(-100, -100)
            mySprite.setPosition(-100, -100)
            scene.setBackgroundImage(titleScreen)
            break;
        
        case STATE_LEVEL_INTRO:
            scene.setBackgroundImage(blankBackground)
            scene.backgroundImage().printCenter("Level " + (currentLevel + 1), 30, 15)
            scene.backgroundImage().printCenter("Lives " + playerLives, 50, 15)
            timer = LEVEL_INTRO_DURATION
            break;

        case STATE_LEVEL_INIT:
            tiles.setTilemap(levels[currentLevel])
            sharkTargetWaypoint = null
            break;

        case STATE_LEVEL_PLAY:
            controller.moveSprite(mySprite, PLAYER_MOVE_SPEED, PLAYER_MOVE_SPEED)
            scene.cameraFollowSprite(mySprite)
            break;

        case STATE_LEVEL_END:

            break;
    }
})
game.onUpdate(function () {
    switch(gameState.getState()){
        case STATE_TITLE:
            if(controller.A.isPressed()){
                gameState.changeState(STATE_LEVEL_INTRO)
            }
        break;

        case STATE_LEVEL_INTRO:
            timer -= 1
            if(controller.A.isPressed()){
                //timer = 0
            }
            if(timer <= 0){
                gameState.changeState(STATE_LEVEL_INIT)
            }
        break;

        case STATE_LEVEL_INIT:
            let coinTiles = tiles.getTilesByType(myTiles.tile6)
            coinTiles.forEach(function (value: tiles.Location, index: number) {
                let newCoin = sprites.create(coin.image, SpriteKind.Food)
                tiles.placeOnTile(newCoin, value)
                tiles.setTileAt(value, myTiles.tile4);
                totalGuffins++
            })
            let waypointTiles = tiles.getTilesByType(myTiles.tile22)
            waypointTiles.forEach(function (value: tiles.Location, index: number) {
                tiles.setTileAt(value, myTiles.tile2)
                waypoints.push(new HelperClasses.Waypoint(new HelperClasses.Point(value.x, value.y)))
            })
            waypoints = Pathfinding.connectWaypoints(waypoints)
            let playerSpawnTile = tiles.getTilesByType(myTiles.tile17)[0]
            mySprite.x = playerPosition.x = playerSpawnTile.x
            mySprite.y = playerPosition.y = playerSpawnTile.y
            tiles.setTileAt(playerSpawnTile, myTiles.tile2)
            let octopusSpawnTile = tiles.getTilesByType(myTiles.tile18)[0]
            octopus.x = octopusPosition.x = octopusSpawnTile.x
            octopus.y = octopusPosition.y = octopusSpawnTile.y
            tiles.setTileAt(octopusSpawnTile, myTiles.tile2)
            let sharkSpawnTile = tiles.getTilesByType(myTiles.tile19)[0]
            shark.x = sharkPosition.x = sharkSpawnTile.x
            shark.y = sharkPosition.y = sharkSpawnTile.y
            tiles.setTileAt(sharkSpawnTile, myTiles.tile2)
            gameState.changeState(STATE_LEVEL_PLAY)
        break;

        case STATE_LEVEL_PLAY:
            playerPosition = checkLandBoundsCollision(mySprite, playerPosition)
            playerInWater = isWaterTile(playerPosition.tile)
            // move octopus
            octopusPosition = findOctopusMovePosition(octopusPosition, playerPosition, HIT_BUFFER)
            moveGameSprite(octopusPosition, octopus)
            // move shark
            sharkFollowsPlayer = false
            if (playerInWater && sharkPosition.calculateDistance(playerPosition) <= TILE_SIZE * 10) {
                sharkTargetTile = findSharkTargetTile(playerPosition)
                sharkSeekPath = Pathfinding.seekPath(sharkPosition, playerPosition, 10)
                sharkFollowsPlayer = sharkSeekPath.length > 1
            }
            if(!isWaterTile(sharkPosition.tile)){
                sharkFollowsPlayer = false; //this is a failsafe because sometimes the shark will start to follow the player onto land
            }
            if (sharkFollowsPlayer) {
                sharkTargetWaypoint = null
                moveTowardPoint(sharkPosition, sharkSeekPath[1].point, SHARK_MOVE_SPEED)
                if (sharkPosition.equals(sharkSeekPath[1].point)) {
                    if (sharkPosition.remainder > 0 && sharkSeekPath.length > 2) {
                        moveTowardPoint(sharkPosition, sharkSeekPath[2].point, sharkPosition.remainder)
                    }
                }
            } else {
                if (sharkTargetWaypoint == null) {
                    sharkTargetWaypoint = Pathfinding.getClosestWaypoint(sharkPosition, waypoints)
                }
                moveTowardPoint(sharkPosition, sharkTargetWaypoint.point, SHARK_MOVE_SPEED)
                if (sharkPosition.equals(sharkTargetWaypoint.point)) {
                    waypointHolding = sharkTargetWaypoint
                    if (playerInWater) {
                        sharkTargetWaypoint = sharkTargetWaypoint.getClosestConnectionToPoint(playerPosition)
                    } else {
                        sharkTargetWaypoint = sharkTargetWaypoint.getRandomConnection(sharkPreviousWaypoint === null ? [] : [sharkPreviousWaypoint])
                    }
                    if (sharkPosition.remainder > 0) {
                        moveTowardPoint(sharkPosition, sharkTargetWaypoint.point, sharkPosition.remainder)
                    }
                    sharkPreviousWaypoint = waypointHolding
                }
            }
            moveGameSprite(sharkPosition, shark)
            sharkPosition.remainder = 0
            if(isPlayerDead(mySprite, shark, octopus)){
                gameState.changeState(STATE_LEVEL_PLAYER_DEAD)
            }
            if (isWinningTile(playerPosition.tile)) {
                currentLevel++
                gameState.changeState(STATE_LEVEL_END)
            }
        break;

        case STATE_LEVEL_END:
                gameState.changeState(STATE_LEVEL_INTRO)
        break;
    }
})

music.setVolume(20)
gameState.changeState(STATE_TITLE);
