namespace myTiles {
    //% blockIdentity=images._tile
    export const tile0 = img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `
    //% blockIdentity=images._tile
    export const tile2 = img`
        b b b b b b b b
        e e e b b b b b
        b b b b b b b b
        b b b b b e e e
        b b b b b b b b
        b b e e e e e b
        b b b b b b b b
        b e e b b b e b
    `
    //% blockIdentity=images._tile
    export const tile3 = img`
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
    `
    //% blockIdentity=images._tile
    export const tile4 = img`
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
        7 7 7 7 7 7 7 7
    `
    //% blockIdentity=images._tile
    export const tile5 = img`
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
    `
    //% blockIdentity=images._tile
    export const tile6 = img`
        7 5 5 5 5 5 5 7
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        5 7 7 7 7 7 7 5
        7 5 5 5 5 5 5 7
    `
    //% blockIdentity=images._tile
    export const tile7 = img`
        b b b b b b b b
        e e e e e e e e
        d d d d d d d d
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
    `
    //% blockIdentity=images._tile
    export const tile8 = img`
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        d d d d d d d d
        e e e e e e e e
        b b b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile9 = img`
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d d d d d d
        b e e e e e e e
        b b b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile10 = img`
        b b b b b b b b
        e e e e e e e b
        d d d d d d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
    `
    //% blockIdentity=images._tile
    export const tile11 = img`
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        8 8 8 8 8 d e b
        d d d d d d e b
        e e e e e e e b
        b b b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile12 = img`
        b b b b b b b b
        b e e e e e e e
        b e d d d d d d
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
        b e d 8 8 8 8 8
    `
    //% blockIdentity=images._tile
    export const tile13 = img`
        8 8 8 8 8 d e b
        8 8 8 8 8 d e e
        8 8 8 8 8 d d d
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
    `
    //% blockIdentity=images._tile
    export const tile14 = img`
        b e d 8 8 8 8 8
        e e d 8 8 8 8 8
        d d d 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
    `
    //% blockIdentity=images._tile
    export const tile15 = img`
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        d d d 8 8 8 8 8
        e e d 8 8 8 8 8
        b e d 8 8 8 8 8
    `
    //% blockIdentity=images._tile
    export const tile16 = img`
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 8 8 8
        8 8 8 8 8 d d d
        8 8 8 8 8 d e e
        8 8 8 8 8 d e b
    `
    //% blockIdentity=images._tile
    export const tile17 = img`
        b b b b b b b b
        b b 3 3 3 b b b
        b b 3 b b 3 b b
        b b 3 b b 3 b b
        b b 3 3 3 b b b
        b b 3 b b b b b
        b b 3 b b b b b
        b b b b b b b b
    `
    //% blockIdentity=images._tile
    export const tile18 = img`
        d b b b b b b d
        b d b b b b d b
        b b d b b d b b
        b b b d d b b b
        b b b d d b b b
        b b d b b d b b
        b d b b b b d b
        d b b b b b b d
    `
    //% blockIdentity=images._tile
    export const tile19 = img`
        b b b b b b b b
        b b 2 2 2 b b b
        b 2 b b b 2 b b
        b 2 b b b b b b
        b b 2 2 2 b b b
        b b b b b 2 b b
        b 2 b b b 2 b b
        b b 2 2 2 b b b
    `
    //% blockIdentity=images._tile
    export const tile20 = img`
        4 4 4 4 4 4 4 4
        4 4 4 4 4 4 4 4
        5 5 5 5 5 5 5 5
        4 4 4 4 4 4 4 4
        4 4 4 4 4 4 4 4
        5 5 5 5 5 5 5 5
        4 4 4 4 4 4 4 4
        4 4 4 4 4 4 4 4
    `
    //% blockIdentity=images._tile
    export const tile21 = img`
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
        4 4 5 4 4 5 4 4
    `
    //% blockIdentity=images._tile
    export const tile22 = img`
        b b b 5 5 b b b
        b 5 b 5 5 b 5 b
        b b b 5 b b b b
        5 5 b b b 5 5 5
        5 5 5 b b b 5 5
        b b b b 5 b b b
        b 5 b 5 5 b 5 b
        b b b 5 5 b b b
    `
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function (sprite, otherSprite) {
    info.setScore(info.score() + 1)
    otherSprite.destroy()
})
let i = 0
let j = 0
let sharkSeekPath: Array<HelperClasses.PathPosition> = []
let waypoints: Array<HelperClasses.Waypoint> = []
const HIT_BUFFER = 4
const TILE_SIZE = 8
const PLAYER_MOVE_SPEED = 40
let playerPosition: HelperClasses.Point = new HelperClasses.Point(0, 0)
let octopusPosition: HelperClasses.Point = new HelperClasses.Point(0, 0)
let sharkPosition: HelperClasses.Point = new HelperClasses.Point(0, 0)
let mySprite = sprites.create(img`
    . . . . . . . .
    . . . 1 1 . . .
    . . 1 1 1 1 . .
    3 4 1 1 1 1 4 3
    3 4 4 1 1 4 4 3
    . . 4 1 1 4 . .
    . . 1 1 1 1 . .
    . . . . . . . .
`, SpriteKind.Player)
let octopus = sprites.create(img`
    . a d d d . . . . . . . a d d d d d . . . . . . . . a a d d . .
    a d d . . . . . . . . a d d d d d d d d . . . . . a d d d d d .
    a d . . . . . . . . a d d 1 . . . . . d d . . . . a d . . . d d
    a d . . . . . . . . a d 1 . . . . . . . . . . . a d 1 . . . d d
    a d . . . . . . . . a d 1 . . . . . . . . . . a d d 1 . . . . d
    a d 1 . . . . . . . a d d d . . . . . . . . a d d d 1 . . . . .
    a d d 1 . . . . . . a d d a a a a a d d . . a d d d . . . . . .
    . a d d 1 . . . . . . a a d d d d d d d d d d d 1 . . . . . . .
    . . a d d d d d d . a d d d d d a d d d d d d d 1 . . . . . . .
    . . . a a d d d d a d d d a d d d d d d a d d d . . . . . . . .
    . . . . . a d d d a d d d d d d d d d d d d d d . . . . . a d .
    . . . . . . a a a d d d d d d d d a d d d d d d d . a a a d d d
    . . . . . . . . a d d a d d d d d d d d d d a d d a d d d d d d
    . . . . . . . . d d d d d d d d d d d d d d d d d d d 1 1 . d d
    . . . . . . . . d d d d d d d 1 1 1 d d d d d d d d d . . . d d
    . . . . . . . . d d d d d d 1 a a a 1 d d d d d d . . . . . . d
    . . . . . . . a d d d d d d 1 a d a 1 d d d d d 1 . . . . d d d
    . . . . . . a d d d d d d d 1 a d a 1 d d d d d 1 . . . . d d .
    . . . . a a d d d d d d d d 1 a a a 1 d d d d 1 d . . . . d . .
    . . a a d d d d d d d d d d d 1 1 1 d d d d d 1 d d 1 . . . . .
    . a d d d d d 1 1 1 d d d d d d d d d d d d d d d d 1 . . . . .
    a d d d d . . . . . a a d d d d d d d d 1 1 . d d d d 1 . . . .
    a d d d . . . . . a d d d d d d d 1 1 1 d 1 . . . d d d 1 . . .
    a d d . . . . . . a d d d d . . . d d d d 1 . . . a d d 1 . . .
    a d d . . . . . . a d d . . . . . . a d d 1 . . . . . d d 1 . .
    a d d . . . . . . a d d . . . . . . . a d d 1 . . . . d d 1 . .
    a d d . . . . . a d d . . . . . . . . . a d 1 . . . . a d d 1 .
    d d . . . . . . a d d . . . . . . . . . a d d . . . . . d d d .
    d d . . . . . . a d d . . . . . . . . . . d d d . . . . . d d d
    d d . . . . . . a d d . . . . . . . . d . . d d . . . . . . a d
    d d d . . . . . . a d . . . . . . . . d d d d d . . . . . . d d
    . d d . . . . . . . d d d . . . . . . . d d d . . . . . . d . .
`, SpriteKind.Enemy)
let shark = sprites.create(img`
    . . . . 8 d d .
    . . . 8 d d . .
    . . 8 d 1 . . .
    . 8 d d 1 . . .
    . 8 d d d 1 . .
    . d d d d d 1 .
    7 d d d d d d 7
    . 7 7 7 7 7 7 .
`, SpriteKind.Enemy)
let coin = sprites.create(img`
    . . 4 4 4 4 . .
    . 4 5 5 5 5 4 .
    4 5 5 4 5 5 5 4
    4 5 5 4 5 5 5 4
    4 5 5 4 5 5 5 4
    4 5 5 4 5 5 5 4
    . 4 5 5 5 5 4 .
    . . 4 4 4 4 . .
`, SpriteKind.Food)
controller.moveSprite(mySprite)
scene.cameraFollowSprite(mySprite)
tiles.setTilemap(tiles.createTilemap(
            hex`2000200001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010110010101010101010101010101010101010101010101010101110101010101010101010101010101010101010101010101010101010101010101010101010101010115010101010101010101010101010101010101150101010101010101010101010101011313010101010101010101010101010101010101010101010101010101010102030303030303030303030303030314010101010101010101010101120101010203030303030303030303030303031401010101010101010101010101010101020503040101010101010101010101010101010101010101010101010101010102030304011501010101010101010101011501010101010101010101010101010203050401010101010101010101010101010101010101010101010101010101020303040101010101010101010101010101010101010101010101010101010102050304010101010101010101010101010101010101010101010101010101010203030401010101010101010101010101010101010101010101010101010101020305040101010101010101010101010101010101010101010101010101010102030304010101010101010101010101010101010101010101010101010101010205030401010101010101010101010101010101010101010101010101010101020303040101010101010101010101010101010101010101010101010101010102030504010101010101010101010101010101010101010101010101010101010203030401010101010101010101010101010101010101010101010101010101020503040101010101010101010101010101010101010101010101010101010101131301010101010101010101010101010101010101010101010101010115010101010101150101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101`,
            img`
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            `,
            [myTiles.tile0,myTiles.tile2,myTiles.tile3,myTiles.tile4,myTiles.tile5,myTiles.tile6,myTiles.tile7,myTiles.tile8,myTiles.tile9,myTiles.tile10,myTiles.tile11,myTiles.tile12,myTiles.tile13,myTiles.tile14,myTiles.tile15,myTiles.tile16,myTiles.tile17,myTiles.tile18,myTiles.tile19,myTiles.tile20,myTiles.tile21,myTiles.tile22],
            TileScale.Eight
        ))
let coinTiles = tiles.getTilesByType(myTiles.tile6)
coinTiles.forEach(function (value: tiles.Location, index: number) {
    let newCoin = sprites.create(coin.image, SpriteKind.Food)
    tiles.placeOnTile(newCoin, value)
    tiles.setTileAt(value, myTiles.tile4);
})
let waypointTiles = tiles.getTilesByType(myTiles.tile22)
waypointTiles.forEach(function (value: tiles.Location, index: number) {
    tiles.setTileAt(value, myTiles.tile2)
    waypoints.push(new HelperClasses.Waypoint(new HelperClasses.Point(value.x, value.y)))
})
while (i > -1) {
    let validConnection = false
    j = i - 1
    while (j > -1) {
        validConnection = false
        if (waypoints[i].point.x == waypoints[j].point.x ||
            waypoints[i].point.y == waypoints[j].point.y) {
            validConnection = true
            //need to double check that there is no land in between
            let connectingTiles = getTilesBetweenPoints(waypoints[i].point, waypoints[j].point, TILE_SIZE)

        }
        if (validConnection) {
            waypoints[i].connections.push(waypoints[j])
            waypoints[j].connections.push(waypoints[i])
        }
        j--
    }
    i--
}
function getTilesBetweenPoints(point1:HelperClasses.Point, point2:HelperClasses.Point, tilesize:number):Array<tiles.Tile>{
    let tiles:Array<tiles.Tile> = []
    let currentX = 0
    let currentY = 0
    if(point1.x == point2.x){
        currentY = Math.min(point1.y, point2.y);
        currentX = point1.x
    }
    if (point1.y == point2.y) {
        currentY = point1.y;
        currentX = Math.min(point1.y, point2.y);
    }
    return tiles
}
let playerSpawnTile = tiles.getTilesByType(myTiles.tile17)[0]
mySprite.x = playerPosition.x = playerSpawnTile.x
mySprite.y = playerPosition.y = playerSpawnTile.y
tiles.setTileAt(playerSpawnTile, myTiles.tile2)
let octopusSpawnTile = tiles.getTilesByType(myTiles.tile18)[0]
octopus.x = octopusPosition.x = octopusSpawnTile.x
octopus.y = octopusPosition.y = octopusSpawnTile.y
tiles.setTileAt(octopusSpawnTile, myTiles.tile2)
let sharkSpawnTile = tiles.getTilesByType(myTiles.tile19)[0]
shark.x = sharkPosition.x = sharkSpawnTile.x
shark.y = sharkPosition.y = sharkSpawnTile.y
tiles.setTileAt(sharkSpawnTile, myTiles.tile2)
let sharkTargetTile = new HelperClasses.Point()
function positionToTile(position: number, tileSize: number): number {
    return Math.floor(position / tileSize);
}
function isWaterTile(tileImage: Image): boolean {
    if (tileImage == myTiles.tile2 ||
        tileImage == myTiles.tile3 ||
        tileImage == myTiles.tile5 ||
        tileImage == myTiles.tile7 ||
        tileImage == myTiles.tile8 ||
        tileImage == myTiles.tile9 ||
        tileImage == myTiles.tile10 ||
        tileImage == myTiles.tile11 ||
        tileImage == myTiles.tile12 ||
        tileImage == myTiles.tile13 ||
        tileImage == myTiles.tile14 ||
        tileImage == myTiles.tile15 ||
        tileImage == myTiles.tile16) {
        return true
    }
    return false
}
function isLandTile(tileImage: Image): boolean {
    if (tileImage == myTiles.tile4) {
        return true
    }
    return false
}
function checkLandBoundsCollision(character: Sprite, lastPosition: HelperClasses.Point): HelperClasses.Point {
    let newTile: Image = tiles.getTileAt(positionToTile(character.x, TILE_SIZE), positionToTile(character.y, TILE_SIZE))
    if (lastPosition.tile == null) {
        lastPosition.tile = newTile
    }

    if (isLandTile(newTile) && isWaterTile(lastPosition.tile) ||
        isWaterTile(newTile) && isLandTile(lastPosition.tile)) {
        //todo: determine whether it's a horizontal or vertical collision and limit movement
        //also need to check whether the other position change results in a tile collision, like in a corner
        character.x = lastPosition.x
        character.y = lastPosition.y
        return lastPosition;
    }
    lastPosition.x = character.x
    lastPosition.y = character.y
    lastPosition.tile = newTile
    return lastPosition
}
function findOctopusMovePosition(octopusPosition: HelperClasses.Point, playerPosition: HelperClasses.Point, buffer: number): HelperClasses.Point {
    let moveLeft: boolean = playerPosition.x < octopusPosition.x - buffer
    let moveRight: boolean = playerPosition.x > octopusPosition.x + buffer
    let moveUp: boolean = playerPosition.y < octopusPosition.y - buffer
    let moveDown: boolean = playerPosition.y > octopusPosition.y + buffer
    let moveRate: number = .4

    if (moveLeft) {
        octopusPosition.x -= moveRate
    } else if (moveRight) {
        octopusPosition.x += moveRate
    }
    if (moveUp) {
        octopusPosition.y -= moveRate
    } else if (moveDown) {
        octopusPosition.y += moveRate
    }
    return octopusPosition
}
function findSharkMovePosition(sharkPosition: HelperClasses.Point, seekPath: Array<HelperClasses.PathPosition>): HelperClasses.Point {

    //need to keep track of tile position of player and only recalculate if the player has changed tiles

    return sharkPosition
}
function findSharkTargetTile(playerPosition: HelperClasses.Point): HelperClasses.Point {
    let resultGridSpot = new HelperClasses.Point()
    if (isWaterTile(playerPosition.tile)) {
        resultGridSpot.y = playerPosition.y
        resultGridSpot.x = playerPosition.x
        return resultGridSpot
    }
    //todo: implement roaming

    return resultGridSpot
}
function moveGameSprite(position: HelperClasses.Point, sprite: Sprite): void {
    sprite.x = Math.floor(position.x)
    sprite.y = Math.floor(position.y)
}
game.onUpdate(function () {
    playerPosition = checkLandBoundsCollision(mySprite, playerPosition)
// move octopus
    octopusPosition = findOctopusMovePosition(octopusPosition, playerPosition, HIT_BUFFER)
moveGameSprite(octopusPosition, octopus)
// move shark
    sharkTargetTile = findSharkTargetTile(playerPosition)
if (sharkTargetTile.getColumn() > 0 && sharkTargetTile.getRow() > 0) {
        if (sharkSeekPath.length == 0 || !(sharkTargetTile.equals(sharkSeekPath[sharkSeekPath.length - 1].point))) {
        	
        }
    }
    sharkPosition = findSharkMovePosition(sharkPosition, sharkSeekPath)
moveGameSprite(sharkPosition, shark)
})
